
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>WavelengthPolyFit &#8212; ASPIRED 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StandardFlux" href="standardflux.html" />
    <link rel="prev" title="OneDSpec" href="onedspec.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="wavelengthpolyfit">
<h1>WavelengthPolyFit<a class="headerlink" href="#wavelengthpolyfit" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="aspired.aspired.WavelengthPolyFit">
<em class="property">class </em><code class="sig-prename descclassname">aspired.aspired.</code><code class="sig-name descname">WavelengthPolyFit</code><span class="sig-paren">(</span><em class="sig-param">spec</em>, <em class="sig-param">arc</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#WavelengthPolyFit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.WavelengthPolyFit" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a wrapper for using RASCAL to perform wavelength calibration,
which can handle arc lamps containing Xe, Cu, Ar, Hg, He, Th, Fe. This
guarantees to provide something sensible or nothing at all. It will
require some fine-tuning when using the first time. The more GOOD
initial guesses provided, the faster the solution converges and with
better fit. Knowing the dispersion, wavelength ranges and one or two
known lines will significantly improve the fit. Conversely, wrong
values supplied by the user will siginificantly distort the solution
as any user supplied information will be treated as the ground truth.</p>
<p>Deatils of how RASCAL works should be referred to</p>
<blockquote>
<div><p><a class="reference external" href="https://rascal.readthedocs.io/en/latest/">https://rascal.readthedocs.io/en/latest/</a></p>
</div></blockquote>
<dl class="simple">
<dt>spec: TwoDSpec object</dt><dd><p>TwoDSpec of the science/standard image containing the trace(s).</p>
</dd>
<dt>arc: 2D numpy array</dt><dd><p>The image of the arc image.</p>
</dd>
</dl>
<dl class="method">
<dt id="aspired.aspired.WavelengthPolyFit.calibrate">
<code class="sig-name descname">calibrate</code><span class="sig-paren">(</span><em class="sig-param">elements=None</em>, <em class="sig-param">min_wave=3500.0</em>, <em class="sig-param">max_wave=8500.0</em>, <em class="sig-param">sample_size=5</em>, <em class="sig-param">max_tries=5000</em>, <em class="sig-param">top_n=20</em>, <em class="sig-param">nslopes=1000</em>, <em class="sig-param">range_tolerance=500.0</em>, <em class="sig-param">fit_tolerance=20.0</em>, <em class="sig-param">polydeg=5</em>, <em class="sig-param">candidate_thresh=15.0</em>, <em class="sig-param">ransac_thresh=1</em>, <em class="sig-param">xbins=50</em>, <em class="sig-param">ybins=50</em>, <em class="sig-param">brute_force=False</em>, <em class="sig-param">fittype='poly'</em>, <em class="sig-param">mode='manual'</em>, <em class="sig-param">progress=False</em>, <em class="sig-param">coeff=None</em>, <em class="sig-param">display=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#WavelengthPolyFit.calibrate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.WavelengthPolyFit.calibrate" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper function to perform wavelength calibration with RASCAL.</p>
<p>As of 14 January 2020, it supports He, Ne, Ar, Cu, Kr, Cd, Xe,
Hg and Th from NIST:</p>
<blockquote>
<div><p><a class="reference external" href="https://physics.nist.gov/PhysRefData/ASD/lines_form.html">https://physics.nist.gov/PhysRefData/ASD/lines_form.html</a></p>
</div></blockquote>
<p>If there is already a set of good coefficienes, use calibrate_pfit()
instead.</p>
<dl>
<dt>elements: string or list of string</dt><dd><p>String or list of strings of Chemical symbol. Case insensitive.</p>
</dd>
<dt>min_wave: float</dt><dd><p>Minimum wavelength of the bluest arc line, NOT OF THE SPECTRUM.</p>
</dd>
<dt>max_wave: float</dt><dd><p>Maximum wavelength of the reddest arc line, NOT OF THE SPECTRUM.</p>
</dd>
<dt>sample_size: int</dt><dd><p>Number of lines to be fitted in each loop.</p>
</dd>
<dt>max_tries: int</dt><dd><p>Number of trials of polynomial fitting.</p>
</dd>
<dt>top_n: int</dt><dd><p>Top ranked lines to be fitted.</p>
</dd>
<dt>nslopes: int</dt><dd><p>Number of lines to be used in Hough transform.</p>
</dd>
<dt>range_tolerance: float</dt><dd><p>Estimation of the error on the provided spectral range
e.g. 3000 - 5000 with tolerance 500 will search for
solutions that may satisfy 2500 - 5500</p>
</dd>
<dt>fit_tolerance: float</dt><dd><p>Maximum RMS allowed</p>
</dd>
<dt>polydeg: int</dt><dd><p>Degree of the polynomial</p>
</dd>
<dt>candidate_thresh: float</dt><dd><p>Threshold for considering a point to be an inlier during candidate
peak/line selection. Don’t make this too small, it should allow
for the error between a linear and non-linear fit.</p>
</dd>
<dt>ransac_thresh: float</dt><dd><p>The distance criteria to be considered an inlier to a fit. This
should be close to the size of the expected residuals on the final
fit.</p>
</dd>
<dt>xbins: int</dt><dd><p>The number of bins in the pixel direction (in Hough space).</p>
</dd>
<dt>ybins<span class="classifier">int</span></dt><dd><p>The number of bins in the wavelength direction (in Hough space).</p>
</dd>
<dt>brute_force: tuple</dt><dd><p>Set to try all possible combinations and choose the best fit as
the solution. This takes tens of minutes for tens of lines.</p>
</dd>
<dt>fittype: string</dt><dd><p>One of ‘poly’, ‘legendre’ or ‘chebyshev’.</p>
</dd>
<dt>mode: string</dt><dd><p>Default to ‘manual’ to read take in user supplied sample_size,
max_tries, top_n and nslope, which are by default equivalent to
‘normal’ mode. Predefined modes are ‘fast’, ‘normal’ and ‘slow’:
fast:</p>
<blockquote>
<div><p>sample_size = 3, max_tries = 1000, top_n = 20, nslope = 500</p>
</div></blockquote>
<dl class="simple">
<dt>normal:</dt><dd><p>sample_size = 5, max_tries = 5000, top_n = 20, nslope = 1000</p>
</dd>
<dt>slow:</dt><dd><p>sample_size = 5, max_tries = 10000, top_n = 20, nslope = 2000</p>
</dd>
</dl>
</dd>
<dt>progress: tuple</dt><dd><p>Set to show the progress using tdqm (if imported).</p>
</dd>
<dt>pfit: list</dt><dd><p>List of the polynomial fit coefficients for the first guess.</p>
</dd>
<dt>display: tuple</dt><dd><p>Set to show diagnostic plot.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.WavelengthPolyFit.calibrate_pfit">
<code class="sig-name descname">calibrate_pfit</code><span class="sig-paren">(</span><em class="sig-param">elements</em>, <em class="sig-param">pfit</em>, <em class="sig-param">min_wave=3500.0</em>, <em class="sig-param">max_wave=8500.0</em>, <em class="sig-param">tolerance=10.0</em>, <em class="sig-param">display=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#WavelengthPolyFit.calibrate_pfit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.WavelengthPolyFit.calibrate_pfit" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper function to fine tune wavelength calibration with RASCAL
when there is already a set of good coefficienes.</p>
<p>As of 14 January 2020, it supports He, Ne, Ar, Cu, Kr, Cd, Xe,
Hg and Th from NIST:</p>
<blockquote>
<div><p><a class="reference external" href="https://physics.nist.gov/PhysRefData/ASD/lines_form.html">https://physics.nist.gov/PhysRefData/ASD/lines_form.html</a></p>
</div></blockquote>
<dl class="simple">
<dt>elements: string or list of string</dt><dd><p>String or list of strings of Chemical symbol. Case insensitive.</p>
</dd>
<dt>pfit<span class="classifier">list</span></dt><dd><p>List of polynomial fit coefficients</p>
</dd>
<dt>min_wave: float</dt><dd><p>Minimum wavelength of the bluest arc line, NOT OF THE SPECTRUM.</p>
</dd>
<dt>max_wave: float</dt><dd><p>Maximum wavelength of the reddest arc line, NOT OF THE SPECTRUM.</p>
</dd>
<dt>tolerance<span class="classifier">float</span></dt><dd><p>Absolute difference between fit and model.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.WavelengthPolyFit.find_arc_lines">
<code class="sig-name descname">find_arc_lines</code><span class="sig-paren">(</span><em class="sig-param">percentile=20.0</em>, <em class="sig-param">distance=5.0</em>, <em class="sig-param">display=False</em>, <em class="sig-param">jsonstring=False</em>, <em class="sig-param">renderer='default'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#WavelengthPolyFit.find_arc_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.WavelengthPolyFit.find_arc_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>This function applies the trace to the arc image then take median
average of the stripe before identifying the arc lines (peaks) with
scipy.signal.find_peaks(), where only the distance and the prominence
keywords are used. Distance is the minimum separation between peaks,
the default value is roughly twice the nyquist sampling rate (i.e.
pixel size is 2.3 times smaller than the object that is being resolved,
hence, the sepration between two clearly resolved peaks are ~5 pixels
apart). An crude estimate of the background can exclude random noise
which look like small peaks.</p>
<dl class="simple">
<dt>percentile: float</dt><dd><p>The percentile of the flux to be used as the estimate of the
background sky level to the first order. [ADU]</p>
</dd>
<dt>distance: float</dt><dd><p>Minimum separation between peaks</p>
</dd>
<dt>display: tuple</dt><dd><p>Set to True to display disgnostic plot.</p>
</dd>
<dt>renderer: string</dt><dd><p>plotly renderer options.</p>
</dd>
<dt>jsonstring: tuple</dt><dd><p>set to True to return json string that can be rendered by Plotly
in any support language.</p>
</dd>
</dl>
<p>JSON strings if jsonstring is set to True</p>
</dd></dl>

</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">ASPIRED</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/pip.html">pip</a></li>
</ul>
<p class="caption"><span class="caption-text">Behind the Scene</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background/imagereduction.html">Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/aptrace.html">Aperture Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/apextract.html">Aperture Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/wavecal.html">Wavelength Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/fluxcal.html">Flux Calibration</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/lt-sprat.html">Example - SPRAT (Liverpool Telescope)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/wht-isis.html">Example - ISIS (William Herschel Telescope)</a></li>
</ul>
<p class="caption"><span class="caption-text">List of Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="imagereduction.html">ImageReduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="twodspec.html">TwoDSpec</a></li>
<li class="toctree-l1"><a class="reference internal" href="onedspec.html">OneDSpec</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">WavelengthPolyFit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aspired.aspired.WavelengthPolyFit">WavelengthPolyFit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="standardflux.html">StandardFlux</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="onedspec.html" title="previous chapter">OneDSpec</a></li>
      <li>Next: <a href="standardflux.html" title="next chapter">StandardFlux</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Marco Lam.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/modules/wavelengthpolyfit.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>