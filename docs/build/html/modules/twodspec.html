
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>TwoDSpec &#8212; ASPIRED 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OneDSpec" href="onedspec.html" />
    <link rel="prev" title="ImageReduction" href="imagereduction.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="twodspec">
<h1>TwoDSpec<a class="headerlink" href="#twodspec" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="aspired.aspired.TwoDSpec">
<em class="property">class </em><code class="sig-prename descclassname">aspired.aspired.</code><code class="sig-name descname">TwoDSpec</code><span class="sig-paren">(</span><em class="sig-param">img</em>, <em class="sig-param">Saxis=1</em>, <em class="sig-param">spatial_mask=(1</em>, <em class="sig-param">)</em>, <em class="sig-param">spec_mask=(1</em>, <em class="sig-param">)</em>, <em class="sig-param">flip=False</em>, <em class="sig-param">cr=True</em>, <em class="sig-param">cr_sigma=5.0</em>, <em class="sig-param">rn=None</em>, <em class="sig-param">gain=None</em>, <em class="sig-param">seeing=None</em>, <em class="sig-param">exptime=None</em>, <em class="sig-param">silence=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>Currently, there is no automated way to decide if a flip is needed.</p>
<p>The supplied file should contain 2 or 3 columns with the following
structure:</p>
<blockquote>
<div><p>column 1: one of bias, dark, flat or light
column 2: file location
column 3: HDU number (default to 0 if not given)</p>
</div></blockquote>
<p>If the 2D spectrum is
+——–+——–+——-+——-+
|  blue  |   red  | Saxis |  flip |
+——–+——–+——-+——-+
|  left  |  right |   1   | False |
|  right |  left  |   1   |  True |
|   top  | bottom |   0   | False |
| bottom |   top  |   0   |  True |
+——–+——–+——-+——-+</p>
<p>Spectra are sorted by their brightness. If there are multiple spectra
on the image, and the target is not the brightest source, use at least
the number of spectra visible to eye and pick the one required later.
The default automated outputs is the brightest one, which is the
most common case for images from a long-slit spectrograph.</p>
<dl class="simple">
<dt>img: 2D numpy array (M x N)</dt><dd><p>2D spectral image</p>
</dd>
<dt>Saxis: int, optional</dt><dd><p>Spectral direction, 0 for vertical, 1 for horizontal.
(Default is 1)</p>
</dd>
<dt>spatial_mask: 1D numpy array (N), optional</dt><dd><p>Mask in the spatial direction, can be the indices of the pixels
to be included (size &lt;N) or a 1D numpy array of True/False (size N)
(Default is (1,) i.e. keep everything)</p>
</dd>
<dt>spec_mask: 1D numpy array (M), optional</dt><dd><p>Mask in the spectral direction, can be the indices of the pixels
to be included (size &lt;M) or a 1D numpy array of True/False (size M)
(Default is (1,) i.e. keep everything)</p>
</dd>
<dt>flip: tuple, optional</dt><dd><p>If the frame has to be left-right flipped, set to True.
(Deafult is False)</p>
</dd>
<dt>cr: tuple, optional</dt><dd><p>Set to True to apply cosmic ray rejection by sigma clipping with
astroscrappy if available, otherwise a 2D median filter of size 5
would be used. (default is True)</p>
</dd>
<dt>cr_sigma: float, optional</dt><dd><p>Cosmic ray sigma clipping limit (Deafult is 5.0)</p>
</dd>
<dt>rn: float, optional</dt><dd><p>Readnoise of the detector, not important if noise estimation is
not needed.
(Deafult is None, which will be replaced with 1.0)</p>
</dd>
<dt>gain: float, optional</dt><dd><p>Gain of the detector, not important if noise estimation is
not needed.
(Deafult is None, which will be replaced with 1.0)</p>
</dd>
<dt>seeing: float, optional</dt><dd><p>Seeing in unit of arcsec, use as the first guess of the line
spread function of the spectra.
(Deafult is None, which will be replaced with 1.0)</p>
</dd>
<dt>exptime: float, optional</dt><dd><p>Esposure time for the observation, not important if absolute flux
calibration is not needed.
(Deafult is None, which will be replaced with 1.0)</p>
</dd>
<dt>silence: tuple, optional</dt><dd><p>Set to True to suppress all verbose output.</p>
</dd>
</dl>
<dl class="method">
<dt id="aspired.aspired.TwoDSpec._gaus">
<code class="sig-name descname">_gaus</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">a</em>, <em class="sig-param">b</em>, <em class="sig-param">x0</em>, <em class="sig-param">sigma</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec._gaus"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec._gaus" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple Gaussian function.</p>
<dl class="simple">
<dt>x: float or 1-d numpy array</dt><dd><p>The data to evaluate the Gaussian over</p>
</dd>
<dt>a: float</dt><dd><p>the amplitude</p>
</dd>
<dt>b: float</dt><dd><p>the constant offset</p>
</dd>
<dt>x0: float</dt><dd><p>the center of the Gaussian</p>
</dd>
<dt>sigma: float</dt><dd><p>the width of the Gaussian</p>
</dd>
</dl>
<p>Array or float of same type as input (x).</p>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.TwoDSpec._identify_spectra">
<code class="sig-name descname">_identify_spectra</code><span class="sig-paren">(</span><em class="sig-param">f_height</em>, <em class="sig-param">display</em>, <em class="sig-param">renderer</em>, <em class="sig-param">jsonstring</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec._identify_spectra"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec._identify_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Identify peaks assuming the spatial and spectral directions are
aligned with the X and Y direction within a few degrees.</p>
<dl class="simple">
<dt>f_height: float</dt><dd><p>The minimum intensity as a fraction of maximum height.</p>
</dd>
<dt>display: tuple</dt><dd><p>Set to True to display disgnostic plot.</p>
</dd>
<dt>renderer: string</dt><dd><p>plotly renderer options.</p>
</dd>
<dt>jsonstring: tuple</dt><dd><p>set to True to return json string that can be rendered by Plotly
in any support language.</p>
</dd>
</dl>
<dl class="simple">
<dt>peaks_y :</dt><dd><p>Array or float of the pixel values of the detected peaks</p>
</dd>
<dt>heights_y :</dt><dd><p>Array or float of the integrated counts at the peaks</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.TwoDSpec._optimal_signal">
<code class="sig-name descname">_optimal_signal</code><span class="sig-paren">(</span><em class="sig-param">pix</em>, <em class="sig-param">xslice</em>, <em class="sig-param">sky</em>, <em class="sig-param">mu</em>, <em class="sig-param">sigma</em>, <em class="sig-param">display</em>, <em class="sig-param">renderer</em>, <em class="sig-param">jsonstring</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec._optimal_signal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec._optimal_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate to get optimal signal, for internal use only</p>
<dl class="simple">
<dt>pix: 1-d numpy array</dt><dd><p>pixel number along the spatial direction</p>
</dd>
<dt>xslice: 1-d numpy array</dt><dd><p>ADU along the pix</p>
</dd>
<dt>sky: 1-d numpy array</dt><dd><p>ADU of the fitted sky along the pix</p>
</dd>
<dt>mu: float</dt><dd><p>The center of the Gaussian</p>
</dd>
<dt>sigma: float</dt><dd><p>The width of the Gaussian</p>
</dd>
<dt>display: tuple</dt><dd><p>Set to True to display disgnostic plot.</p>
</dd>
<dt>renderer: string</dt><dd><p>plotly renderer options.</p>
</dd>
<dt>jsonstring: tuple</dt><dd><p>set to True to return json string that can be rendered by Plotly
in any support language.</p>
</dd>
</dl>
<dl class="simple">
<dt>signal: float</dt><dd><p>The optimal signal.</p>
</dd>
<dt>noise: float</dt><dd><p>The noise associated with the optimal signal.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.TwoDSpec.ap_extract">
<code class="sig-name descname">ap_extract</code><span class="sig-paren">(</span><em class="sig-param">apwidth=7</em>, <em class="sig-param">skysep=3</em>, <em class="sig-param">skywidth=5</em>, <em class="sig-param">skydeg=1</em>, <em class="sig-param">optimal=True</em>, <em class="sig-param">display=False</em>, <em class="sig-param">renderer='default'</em>, <em class="sig-param">jsonstring=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec.ap_extract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec.ap_extract" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the spectra using the traces, support aperture or optimal
extraction. The sky background is fitted in one dimention only. The
uncertainty at each pixel is also computed, but it is only meaningful
if correct gain, read noise and are provided.</p>
<p>apwidth: int, optional
skysep: int, optional</p>
<blockquote>
<div><p>The separation in pixels from the aperture to the sky window.
(Default is 3)</p>
</div></blockquote>
<dl class="simple">
<dt>skywidth: int, optional</dt><dd><p>The width in pixels of the sky windows on either side of the
aperture. (Default is 7)</p>
</dd>
<dt>skydeg: int, optional</dt><dd><p>The polynomial order to fit between the sky windows.
(Default is 0, i.e. constant flat sky level)</p>
</dd>
<dt>optimal: tuple, optional</dt><dd><p>Set optimal extraction. (Default is True)</p>
</dd>
<dt>silence: tuple, optional</dt><dd><p>Set to disable warning/error messages. (Default is False)</p>
</dd>
<dt>display: tuple, optional</dt><dd><p>Set to True to display disgnostic plot.</p>
</dd>
<dt>renderer: string, optional</dt><dd><p>plotly renderer options.</p>
</dd>
<dt>jsonstring: tuple, optional</dt><dd><p>set to True to return json string that can be rendered by Plotly
in any support language.</p>
</dd>
</dl>
<dl class="simple">
<dt>onedspec: 1-d array</dt><dd><p>The summed adu at each column about the trace. Note: is not
sky subtracted!</p>
</dd>
<dt>skyadu: 1-d array</dt><dd><p>The integrated sky values along each column, suitable for
subtracting from the output of ap_extract</p>
</dd>
<dt>aduerr: 1-d array</dt><dd><p>the uncertainties of the adu values</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.TwoDSpec.ap_trace">
<code class="sig-name descname">ap_trace</code><span class="sig-paren">(</span><em class="sig-param">nspec=1</em>, <em class="sig-param">nwindow=25</em>, <em class="sig-param">spec_sep=5</em>, <em class="sig-param">resample_factor=10</em>, <em class="sig-param">rescale=False</em>, <em class="sig-param">scaling_min=0.975</em>, <em class="sig-param">scaling_max=1.025</em>, <em class="sig-param">scaling_step=0.005</em>, <em class="sig-param">p_bg=5</em>, <em class="sig-param">tol=3</em>, <em class="sig-param">display=False</em>, <em class="sig-param">renderer='default'</em>, <em class="sig-param">jsonstring=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec.ap_trace"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec.ap_trace" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><blockquote>
<div><p>trace: 1-d numpy array (N)</p>
</div></blockquote>
<p>The spatial positions (Y axis) corresponding to the center of the
trace for every wavelength (X axis), as returned from ap_trace</p>
</div></blockquote>
<dl class="simple">
<dt>trace_sigma: float, or 1-d array (1 or N)</dt><dd><dl class="simple">
<dt>Tophat extraction: Float is accepted but will be rounded to an int,</dt><dd><p>which gives the constant aperture size on either
side of the trace to extract.</p>
</dd>
<dt>Optimal extraction: Float or 1-d array of the same size as the trace.</dt><dd><p>If a float is supplied, a fixed standard deviation
will be used to construct the gaussian weight
function along the entire spectrum.</p>
</dd>
</dl>
</dd>
</dl>
<p>nspec: int, optional</p>
<p>nwindow: int, optional</p>
<p>spec_sep: int, optional</p>
<p>resample_factor: int, optional</p>
<p>rescale: tuple, optional</p>
<p>scaling_min: float, optional</p>
<p>scaling_max: float, optional</p>
<p>scaling_step: float, optional</p>
<p>p_bg: float, optional</p>
<p>tol: float, optional</p>
<dl class="simple">
<dt>display: tuple, optional</dt><dd><p>Set to True to display disgnostic plot.</p>
</dd>
<dt>renderer: string, optional</dt><dd><p>plotly renderer options.</p>
</dd>
<dt>jsonstring: tuple, optional</dt><dd><p>set to True to return json string that can be rendered by Plotly
in any support language.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aspired.aspired.TwoDSpec.ap_trace_quick">
<code class="sig-name descname">ap_trace_quick</code><span class="sig-paren">(</span><em class="sig-param">nspec=1</em>, <em class="sig-param">nsteps=20</em>, <em class="sig-param">recenter=False</em>, <em class="sig-param">prevtrace=(0</em>, <em class="sig-param">)</em>, <em class="sig-param">fittype='spline'</em>, <em class="sig-param">order=3</em>, <em class="sig-param">bigbox=8</em>, <em class="sig-param">display=False</em>, <em class="sig-param">renderer='default'</em>, <em class="sig-param">jsonstring=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aspired/aspired.html#TwoDSpec.ap_trace_quick"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aspired.aspired.TwoDSpec.ap_trace_quick" title="Permalink to this definition">¶</a></dt>
<dd><p>Trace the spectrum aperture in an image. It only works for bright
spectra with good wavelength coverage.</p>
<p>It works by chopping image up in bins along the wavelength direction,
fits a Gaussian for each bin to determine the spatial center of the
trace. Finally, draws a cubic spline through the bins.</p>
<dl class="simple">
<dt>nspec: int, optional</dt><dd><p>Number of spectra to be extracted. It does not guarantee returning
the same number of spectra if fewer can be detected. (Default is 1)</p>
</dd>
<dt>nsteps: int, optional</dt><dd><p>Keyword, number of bins in X direction to chop image into. Use
fewer bins if ap_trace is having difficulty, such as with faint
targets (default is 20, minimum is 4)</p>
</dd>
<dt>recenter: bool, optional</dt><dd><p>Set to True to use previous trace, allow small shift in position
along the spatial direction. Not doing anything if prevtrace is not
supplied. (Default is False)</p>
</dd>
<dt>prevtrace: 1-d numpy array, optional</dt><dd><p>Provide first guess or refitting the center with different parameters.</p>
</dd>
<dt>fittype: string, optional</dt><dd><p>Set to ‘spline’ or ‘polynomial’, using
scipy.interpolate.UnivariateSpline and numpy.polyfit</p>
</dd>
<dt>order: string, optional</dt><dd><p>Degree of the spline or polynomial. Spline must be &lt;= 5.
(default is k=3)</p>
</dd>
<dt>bigbox: float, optional</dt><dd><p>The number of sigma away from the main aperture to allow to trace</p>
</dd>
<dt>silence: tuple, optional</dt><dd><p>Set to disable warning/error messages. (Default is False)</p>
</dd>
<dt>display: tuple, optional</dt><dd><p>Set to True to display disgnostic plot.</p>
</dd>
<dt>renderer: string, optional</dt><dd><p>plotly renderer options.</p>
</dd>
<dt>jsonstring: tuple, optional</dt><dd><p>set to True to return json string that can be rendered by Plotly
in any support language.</p>
</dd>
</dl>
<dl class="simple">
<dt>my: array (N, nspec)</dt><dd><p>The spatial (Y) positions of the trace, interpolated over the
entire wavelength (X) axis</p>
</dd>
<dt>y_sigma: array (N, nspec)</dt><dd><p>The sigma measured at the nsteps.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">ASPIRED</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/pip.html">pip</a></li>
</ul>
<p class="caption"><span class="caption-text">Behind the Scene</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background/imagereduction.html">Image Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/aptrace.html">Aperture Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/apextract.html">Aperture Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/wavecal.html">Wavelength Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/fluxcal.html">Flux Calibration</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/lt-sprat.html">Example - SPRAT (Liverpool Telescope)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/wht-isis.html">Example - ISIS (William Herschel Telescope)</a></li>
</ul>
<p class="caption"><span class="caption-text">List of Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="imagereduction.html">ImageReduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">TwoDSpec</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aspired.aspired.TwoDSpec">TwoDSpec</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="onedspec.html">OneDSpec</a></li>
<li class="toctree-l1"><a class="reference internal" href="wavelengthpolyfit.html">WavelengthPolyFit</a></li>
<li class="toctree-l1"><a class="reference internal" href="standardflux.html">StandardFlux</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="imagereduction.html" title="previous chapter">ImageReduction</a></li>
      <li>Next: <a href="onedspec.html" title="next chapter">OneDSpec</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Marco Lam.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/modules/twodspec.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>